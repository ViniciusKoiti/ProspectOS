@startuml Prospect Enrichment - AI Enhancement Flow
title ğŸ¤– Prospect Enrichment - AI-Powered Data Enhancement

actor "Sales Rep" as SR
participant "Enrichment UI" as UI
box "API Layer" #LightBlue
    participant "ProspectController" as PC
    participant "ProspectEnrichService" as PES
end box
box "AI Module" #LightGreen
    participant "ProspectorAIService" as PAI
    participant "ScoringAIService" as SAI
    participant "StrategyAIService" as STAI
    participant "ChatClient" as CC
end box
box "Core Domain" #LightYellow
    participant "Company" as COMP
    participant "Website" as WEB
    participant "Score" as SCORE
end box

== 1. RequisiÃ§Ã£o de Enriquecimento ==
SR -> UI: Enrich Company Data
note right: Input: Company name, website, industry
UI -> PC: POST /api/prospect/enrich\n{name, website, industry}

== 2. ValidaÃ§Ã£o e CriaÃ§Ã£o ==
PC -> PC: Validate request:\n- name not empty\n- website not empty
PC -> COMP: Company.create(name, Website.of(url), industry)
COMP -> WEB: Website.of(url)
WEB -> WEB: âœ… URL validation & parsing
WEB --> COMP: Valid Website object
COMP -> COMP: Initialize:\n- Score = 0\n- Status = NEW\n- createdAt = now()

== 3. AI Enrichment ==
PC -> PES: enrichCompany(company)
PES -> PAI: Enhanced company analysis

PAI -> CC: AI Prompt:\n"Analyze company: {name}\nWebsite: {url}\nIndustry: {industry}"

note right of CC
**AI Analysis Prompt**
- Company background research
- Technology stack identification
- Market position analysis
- Growth signals detection
- Contact information discovery
- Competitive landscape
end note

CC -> CC: ğŸ§  LLM Processing:\n- Web search for company info\n- Extract structured data\n- Analyze business metrics
CC --> PAI: Structured Analysis:\n{description, technologies[], signals[], contacts[]}

== 4. AI Scoring (Opcional) ==
PAI -> SAI: scoreCompany(analysisData)
SAI -> CC: Scoring prompt with ICP criteria
CC -> CC: ğŸ§  Calculate fit score (0-100)
CC --> SAI: {score, reasoning, breakdown}
SAI -> SCORE: Score.of(value)
SCORE --> SAI: Score object
SAI -> COMP: updateScore(score, reasoning)

== 5. Strategy Recommendation ==
PAI -> STAI: generateStrategy(company, analysis)
STAI -> CC: Strategy prompt based on analysis
CC -> CC: ğŸ§  Generate personalized approach
CC --> STAI: Recommended strategy & messaging

== 6. Response Assembly ==
STAI --> PAI: Strategy recommendations
PAI --> PES: Complete enrichment analysis
PES --> PC: Enriched company data

== 7. Response ==
PC --> UI: ProspectEnrichResponse:\n{name, website, industry, analysis}
UI --> SR: Display enriched data:\n- Company insights\n- Technology stack\n- Contact suggestions\n- Outreach strategy

note left of SR
**Enriched Data Includes:**
âœ… Company background & size
âœ… Technology stack used
âœ… Recent news & signals
âœ… Contact information
âœ… Market position
âœ… Recommended approach
âœ… Personalized messaging
end note

note right of COMP
**Current State (MVP-004 TODO):**
âŒ No contact normalization
âŒ No email filtering/validation in enrichment
âŒ No duplicate detection
âŒ No data quality scoring
end note

@enduml