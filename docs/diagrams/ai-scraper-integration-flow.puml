@startuml AI Scraper Integration - Web Search Flow
title ðŸ” AI Scraper Integration - Web Search Implementation

box "Client Request" #LightBlue
    participant "Service Layer" as SL
end box
box "Scraper Module" #LightGreen
    participant "ScraperClientInterface" as SCI
    participant "AIWebSearchScraperClient" as AISC
    participant "MockScraperClient" as MSC
end box
box "AI Integration" #LightYellow
    participant "ChatClient" as CC
    participant "ScraperProperties" as SP
end box
box "Profile Selection" #LightGray
    participant "Spring Profiles" as PROF
end box

== Profile-Based Bean Selection ==
PROF -> PROF: Check active profiles
alt Profile: production, development
    PROF -> AISC: @Profile("!mock & !test")\nActivate AI implementation
    AISC -> CC: Inject ChatClient
    AISC -> SP: Inject ScraperProperties
else Profile: mock, test
    PROF -> MSC: @Profile({"test", "mock"})\nActivate Mock implementation
    MSC -> MSC: Return hardcoded test data
end

== 1. Website Scraping Request ==
SL -> SCI: scrapeWebsiteSync(website, deep)
note right: Interface abstraction allows\nprofile-based implementation switching

alt AI Implementation (Production)
    SCI -> AISC: Delegate to AI implementation
    AISC -> SP: Get configuration:\n- timeout, retries, deep search

    == 2. AI Web Search ==
    AISC -> AISC: Build search prompt:\n"Research company at {website}"

    note right of AISC
    **Search Prompt Template**
    - Extract company name & description
    - Find contact information
    - Identify technology stack
    - Discover recent news/signals
    - Format as structured JSON
    end note

    AISC -> CC: AI Web Search Prompt
    CC -> CC: ðŸ§  LLM Web Search:\n- Multi-source research\n- Data extraction & structuring\n- Quality validation

    == 3. Response Processing ==
    CC --> AISC: AI Response (JSON/Text)
    AISC -> AISC: parseAIResponse():\n- Extract JSON from response\n- Validate structure\n- Handle parsing errors

    alt JSON Parsing Success
        AISC -> AISC: âœ… Structured data extracted
    else JSON Parsing Failed
        AISC -> AISC: âš ï¸ Fallback to text processing\nCreate basic structure
    end

    AISC --> SCI: ScrapingResponse(success=true, data, error=null)

else Mock Implementation (Test/Dev)
    SCI -> MSC: Delegate to mock implementation
    MSC -> MSC: Return realistic test data:\n- Sample company info\n- Mock contacts & technologies\n- Simulated news items
    MSC --> SCI: ScrapingResponse(success=true, mockData, error=null)
end

== 4. Error Handling ==
note over AISC, CC
**Robust Error Handling**
- AI service timeouts
- Network failures
- Invalid responses
- Rate limiting
- Graceful degradation
end note

alt Error Occurred
    AISC -> AISC: Log error details
    AISC --> SCI: ScrapingResponse(success=false, null, errorMessage)
end

SCI --> SL: Final ScrapingResponse

== News Search Flow ==
SL -> SCI: searchNews(companyName, daysBack)
alt AI Implementation
    SCI -> AISC: AI news search
    AISC -> CC: News search prompt:\n"Find recent news about {company}"
    CC --> AISC: Recent news items
    AISC -> AISC: parseNewsItems():\nFilter and format news
    AISC --> SCI: NewsResponse(newsItems[])
else Mock Implementation
    SCI -> MSC: Mock news search
    MSC --> SCI: NewsResponse(mockNews[])
end

note bottom
**Key Benefits of AI Approach:**
âœ… No external service dependency
âœ… Respects robots.txt automatically
âœ… Multi-source data aggregation
âœ… Intelligent data structuring
âœ… Zero HTML parsing maintenance
âœ… Built-in retry and error handling
end note

@enduml